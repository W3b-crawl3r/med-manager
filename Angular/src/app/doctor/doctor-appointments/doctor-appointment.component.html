<div class="header">
  <h1>Appointments</h1>
  <button class="primary-btn" (click)="openDialog()" title="Not implemented">+ New Appointment</button>
</div>

  <div class="appointments-list" *ngIf="appointments.length; else empty">
  <div class="appointment-card" *ngFor="let a of appointments; let i = index">

    <div class="card-top">
      <h4>{{ a.patientName }}</h4>
      <div class="actions"></div>
    </div>

    <p>{{ a.date }} at {{ a.time }} • <span class="type">{{ a.type }}</span></p>
    <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
      <span class="status" [ngClass]="a.status?.toLowerCase()">{{ a.status }}</span>
    </div>
  </div>
</div>

<ng-template #empty>
  <p class="empty">No appointments scheduled.</p>
</ng-template>

<!-- MODAL -->
<div class="overlay" *ngIf="showDialog" (click)="closeDialog()">
  <div class="dialog" (click)="$event.stopPropagation()">

    <h2>{{ editIndex !== null ? 'Edit Appointment' : 'New Appointment' }}</h2>

    <form (ngSubmit)="submit()">

      <label>Patient *</label>
      <select [(ngModel)]="form.patientId" name="patient" required>
        <option value="" disabled>Select patient</option>
        <option *ngFor="let p of patients" [value]="p.id">{{ p.name }}</option>
      </select>

      <label>Date *</label>
      <div class="weekday-picks">
        <label class="small">Quick pick</label>
        <div class="days">
          <button type="button" class="day-btn" *ngFor="let d of weekdayLabels; let idx = index"
                  (click)="pickWeekday(weekdayOrder[idx])"
                  [class.selected]="selectedWeekday === weekdayOrder[idx]">{{ d }}</button>
        </div>
      </div>

      <input type="date" [(ngModel)]="form.date" name="date" [min]="today" required />

      <div class="times" *ngIf="filteredTimes.length">
        <label class="small">Available times</label>
        <div style="width:100%;display:flex;flex-wrap:wrap;gap:8px;margin-top:6px">
          <button type="button" class="time-btn" *ngFor="let t of filteredTimes" (click)="selectTime(t)"
                  [class.selected]="form.time === t">{{ t }}</button>
        </div>
      </div>

      <label>Time *</label>
      <input type="time" [(ngModel)]="form.time" name="time" required />

      <label>Type</label>
      <input type="text" [(ngModel)]="form.type" name="type" placeholder="General Checkup" />

      <button type="submit" class="primary-btn full">
        {{ editIndex !== null ? 'Update' : 'Schedule' }}
      </button>
    </form>

    <button class="close" (click)="closeDialog()">×</button>
  </div>
</div>