<div class="patient-container">
  <h2>Doctor Patients</h2>

  <div class="actions">
    <input
      type="text"
      placeholder="Search by name or ID"
      [(ngModel)]="searchText"
    />
    <button (click)="addPatient()">Add Patient</button>
  </div>
  <div class="cards">
    <div class="card" *ngFor="let patient of filteredPatients">
      <div class="card-left">
        <div class="avatar">{{ getInitials(patient.name) }}</div>
        <div>
          <div class="name">{{ patient.name }}</div>
          <div class="meta">{{ patient.id }} • {{ patient.age }} yrs • {{ patient.gender }}</div>
        </div>
      </div>
      <div class="card-right">
        <div class="blood">{{ patient.bloodType }}</div>
        <button class="btn" (click)="viewPatient(patient)">Details</button>
      </div>
    </div>
  </div>

  <!-- DETAILS MODAL -->
  <div class="overlay" *ngIf="showDetails && selectedPatient as sp" (click)="closeDetails()">
    <div class="modal" (click)="$event.stopPropagation()">
      <h3>Patient Details</h3>

      <label>Name</label>
      <input [(ngModel)]="sp.name" [readonly]="!editingPatient" />

      <label>Age</label>
      <input type="number" [(ngModel)]="sp.age" [readonly]="!editingPatient" />

      <label>Gender</label>
      <select [(ngModel)]="sp.gender" [disabled]="!editingPatient">
        <option>Male</option>
        <option>Female</option>
        <option>Other</option>
      </select>

      <label>Blood Type</label>
      <input [(ngModel)]="sp.bloodType" [readonly]="!editingPatient" />

      <hr />
      <h4>Recent History (read-only)</h4>
      <ul>
        <li>2025-12-20: Routine checkup — blood pressure stable.</li>
        <li>2025-11-05: Follow-up — prescribed medication.</li>
      </ul>

      <div class="modal-actions">
        <button class="btn" *ngIf="!editingPatient" (click)="closeDetails()">Close</button>
        <button class="btn" *ngIf="!editingPatient" (click)="enableEditing()">Update</button>
        <button class="btn" *ngIf="editingPatient" (click)="closeDetails(); editingPatient=false">Cancel</button>
        <button class="btn" *ngIf="editingPatient" (click)="savePatient()">Save</button>
      </div>
    </div>
  </div>
</div>
