<div class="patients-container">
    <div class="sidebar">
      <h2 class="logo">Med Manager</h2>
      <div class="user">
        <div class="avatar">E</div>
        <div>
          <strong>Emily Roberts</strong>
          <span class="role">SECRETARY</span>
        </div>
      </div>
      <nav>
        <a routerLink="/secretary/dashboard" routerLinkActive="active">Dashboard</a>
        <a routerLink="/patients" routerLinkActive="active" class="active">Patients</a>
        <a routerLink="/secretary/appointments" routerLinkActive="active">Appointments</a>
            </nav>
             <!-- LOGOUT -->
    <button class="logout" (click)="logout()"><span class="material-icons">logout</span> Logout</button>
 
    </div>

    <main class="content">
        <div class="header">
            <div>
              <h1>Patients</h1>
              <p class="subtitle">Manage your patient records</p>
            </div>
          
            <!-- Bouton Add Patient visible seulement si le formulaire est cach√© -->
            <button *ngIf="!showForm" class="btn-add" (click)="toggleForm()">+ Add Patient</button>
          </div>
          
          <!-- Formulaire affich√© quand showForm = true -->
            <div *ngIf="showForm" class="patient-form">
                <h2>New Patient</h2>
              
                <form (ngSubmit)="addPatient(patientForm)" #patientForm="ngForm">
                  <div class="form-row">
                    <div class="form-group">
                      <label>Full Name *</label>
                      <input [(ngModel)]="newPatient.fullName" name="fullName" #fullName="ngModel" required />
                      <div class="error" *ngIf="fullName.invalid && (fullName.dirty || fullName.touched)">
                        Full Name is required
                      </div>
                    </div>
                    <div class="form-group">
                      <label>Age *</label>
                      <input type="number" [(ngModel)]="newPatient.age" name="age" #age="ngModel" required min="1" max="120" />
                      <div class="error" *ngIf="age.errors?.['required'] && (age.dirty || age.touched)">
                        Age is required
                      </div>
                      <div class="error" *ngIf="age.errors?.['min'] && (age.dirty || age.touched)">
                        Age must be greater than 0
                      </div>
                      <div class="error" *ngIf="age.errors?.['max'] && (age.dirty || age.touched)">
                        Age must be less than 120
                      </div>
                    </div>
                    
              
                    <div class="form-group">
                      <label>Gender *</label>
                      <select [(ngModel)]="newPatient.gender" name="gender" #gender="ngModel" required>
                        <option value="" disabled>Select gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                      </select>
                      <div class="error" *ngIf="gender.errors?.['required'] && (gender.dirty || gender.touched)">
                        Gender is required
                      </div>
                    </div>
                    
                    <div class="form-group">
                      <label>Blood Type *</label>
                      <select [(ngModel)]="newPatient.bloodType" name="bloodType" #bloodType="ngModel" required>
                        <option value="" disabled>Select blood type</option>
                        <option>A+</option><option>A-</option>
                        <option>B+</option><option>B-</option>
                        <option>AB+</option><option>AB-</option>
                        <option>O+</option><option>O-</option>
                      </select>
                      <div class="error" *ngIf="bloodType.errors?.['required'] && (bloodType.dirty || bloodType.touched)">
                        Blood type is required
                      </div>
                    </div>
                    
                  </div>
              
                  <div class="form-row">
                    <div class="form-group">
                      <label>Email *</label>
                      <input type="email" [(ngModel)]="newPatient.email" name="email" #email="ngModel" required />
                      <div class="error" *ngIf="email.errors?.['required'] && (email.dirty || email.touched)">
                        Email is required
                      </div>
                      <div class="error" *ngIf="email.errors?.['email'] && (email.dirty || email.touched)">
                        Invalid email format
                      </div>
                    </div>
                    
                    <div class="form-group">
                      <label>Phone *</label>    
                      <input 
                        type="tel" 
                        [(ngModel)]="newPatient.phone" 
                        name="phone" 
                        #phone="ngModel"
                        pattern="^[0-9]{10,}$" 
                        required
                      />
                      <div class="error" *ngIf="patientForm.submitted && phone.errors?.['required']">
                        Phone number is required
                      </div>
                      <div class="error" *ngIf="patientForm.submitted && phone.errors?.['pattern']">
                        Phone number must contain at least 10 digits
                      </div>
                    </div>
                  
                  </div>
              
                  <div class="form-group">
                    <label>Address</label>
                    <input [(ngModel)]="newPatient.address" name="address" />
                  </div>
              
                  <div class="form-group">
                    

                    <label>Allergies (comma separated)</label>
                    <input [(ngModel)]="allergiesInput" name="allergies" />

                  </div>
                    <!-- tes champs -->
                    <div class="form-actions">
                      <button type="submit" class="btn-save">Save</button>
                      <button type="button" class="btn-cancel" (click)="resetForm()">Cancel</button>
                    </div>
                  </form>                  
                 
              </div>
              
        
          
          
          

      <div class="search-section">
        <div class="search-box">
          <input 
            type="text" 
            placeholder="Search patients..." 
            [(ngModel)]="searchQuery"
            (input)="filterPatients()"
            class="search-input"
          />
        </div>
      </div>

      <div class="patients-list">
        <div class="patients-header-row">
          <div class="col-avatar"></div>
          <div class="col-name">Name</div>
          <div class="col-id">ID</div>
          <div class="col-age">Age</div>
          <div class="col-gender">Gender</div>
          <div class="col-blood">Blood Type</div>
          <div class="col-action">Action</div>
        </div>

        <div *ngFor="let patient of filteredPatients" class="patient-row">
          <div class="col-avatar">
            <div class="avatar">{{ patient.fullName.charAt(0).toUpperCase() }}</div>
          </div>
          <div class="col-name">{{ patient.fullName }}</div>
          <div class="col-id">{{ patient.id }}</div>
          <div class="col-age">{{ patient.age }} years</div>
          <div class="col-gender">{{ patient.gender }}</div>
          <div class="col-blood">{{ patient.bloodType }}</div>
          <div class="col-action">
            <button class="btn-view" [routerLink]="['/patient-detail', patient.id]">
              üëÅ View
            </button>
          </div>
        </div>
      </div>

      <div *ngIf="filteredPatients.length === 0" class="empty-state">
        <p>No patients found</p>
      </div>
     
    </main>
  </div>